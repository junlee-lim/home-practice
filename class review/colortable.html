<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>
        ICON EDITOR
    </h1>
    <div id="editor"></div>

    <script>
        function makeElement(name, attributes){
            const node = document.createElement(name);
            if(attributes){
                for(const item in attributes){
                    node.setAttribute(item, attributes[item]);
                }
            }
            return node;
        }

        function createIconEditor(target, nx, ny){
            const $inputColor = makeElement('input', {type: 'color'});
            target.append($inputColor);
            const $inputColorClear = makeElement('input', {type: 'button', value: 'clear'})
            target.append($inputColorClear)
            let isDrawing = false;
            $inputColorClear.addEventListener('click', () => {
                const tdList = document.querySelectorAll('td');
                for(const item of tdList){
                    item.style.backgroundColor = '';
                }
            });

            //테이블 만들기
            const $table = makeElement('table');
            //target의 자식으로 추가하기
            target.append($table);
            $table.style.borderCollapse = 'collapse';
            $table.style.marginTop = '5px';

            //for구문이랑 ny, nx 사용하여 행이랑 칸 만들기(tr: 행, td: 칸)
            for(let y=0; y<ny; y++){
                const $tr = makeElement('tr');
                $table.append($tr);
                for(let x=0; x<nx; x++){
                    const $td = makeElement('td');
                    $td.style.width = $td.style.height = '15px';
                    $td.style.border = '1px solid gray';
                    $tr.append($td)
                    $td.addEventListener('click', (e) => {
                        e.target.style.backgroundColor = e.target.style.backgroundColor ? '' : $inputColor.value
                    })
                    $td.addEventListener('mousedown', (e) => {
                        isDrawing = true;
                        e.target.style.backgroundColor = $inputColor.value;
                    });

                    // 마우스가 위를 지나갈 때
                    $td.addEventListener('mouseover', (e) => {
                        if(isDrawing) {
                            e.target.style.backgroundColor = $inputColor.value;
                        }
                    });
                    window.addEventListener('mouseup', () => {
                        isDrawing = false;
                    });
                }
            }
            //$inputColorClear 클릭하면 td 배열 내의 모든 요소가 비워지도록 하기, *tdList라는 이름으로 td 선택 
        }

        const $editor = document.querySelector('#editor');
        createIconEditor($editor, 20, 20);
        
    </script>

</body>
</html>